#!/bin/bash
# Script de reorganización completa de migraciones
# Generado automáticamente

set -e  # Salir en caso de error

echo "=== REORGANIZACIÓN COMPLETA DE MIGRACIONES ==="

# Crear respaldo
BACKUP_NAME="migrations_backup_$(date +%Y%m%d_%H%M%S)"
echo "Creando respaldo: supabase/$BACKUP_NAME"
cp -r supabase/migrations supabase/$BACKUP_NAME

# Limpiar directorio de migraciones
echo "Limpiando directorio de migraciones..."
cd supabase/migrations
rm -f *.sql

cp "supabase\migrations\20240101000000_fix_product_rls_policies.sql" "20240101000000_fix_product_rls_policies.sql"
cp "supabase\migrations\20240102000000_create_reservations_module.sql" "20240102000000_create_reservations_module.sql"
cp "supabase\migrations\20240103000000_add_payment_method_to_petty_cash.sql" "20240103000000_add_payment_method_to_petty_cash.sql"
cp "supabase\migrations\20240104000000_add_parent_id_to_warehouse.sql" "20240104000000_add_parent_id_to_warehouse.sql"
cp "supabase\migrations\20240105000000_create_supplier_payment_table.sql" "20240105000000_create_supplier_payment_table.sql"
cp "supabase\migrations\20240106000000_create_storage_buckets.sql" "20240106000000_create_storage_buckets.sql"
cp "supabase\migrations\20240107000000_add_type_and_equipment_fields_to_product.sql" "20240107000000_add_type_and_equipment_fields_to_product.sql"
cp "supabase\migrations\20240108000000_add_service_counter_to_product.sql" "20240108000000_add_service_counter_to_product.sql"
cp "supabase\migrations\20240109000000_create_inventory_physical_history_table.sql" "20240109000000_create_inventory_physical_history_table.sql"
cp "supabase\migrations\20240110000000_modular_products_system.sql" "20240110000000_modular_products_system.sql"
cp "supabase\migrations\20240111000000_create_product_package_linkage.sql" "20240111000000_create_product_package_linkage.sql"
cp "supabase\migrations\20240112000000_create_supplier_tags.sql" "20240112000000_create_supplier_tags.sql"
cp "supabase\migrations\20240113000000_update_supplier_rank_constraint.sql" "20240113000000_update_supplier_rank_constraint.sql"
cp "supabase\migrations\20240114000000_fix_supplier_rank_constraint.sql" "20240114000000_fix_supplier_rank_constraint.sql"
cp "supabase\migrations\20240115000000_use_final_price_with_vat.sql" "20240115000000_use_final_price_with_vat.sql"
cp "supabase\migrations\20240116000000_create_modular_reservations.sql" "20240116000000_create_modular_reservations.sql"
cp "supabase\migrations\20240117000000_fix_final_price_with_vat_correct.sql" "20240117000000_fix_final_price_with_vat_correct.sql"
cp "supabase\migrations\20240206000000_add_modular_reservations_rls_policies.sql" "20240118000000_add_modular_reservations_rls_policies.sql"
cp "supabase\migrations\20240207000000_fix_sales_client_references.sql" "20240119000000_fix_sales_client_references.sql"
cp "supabase\migrations\20240208000000_create_budget_lines_function.sql" "20240120000000_create_budget_lines_function.sql"
cp "supabase\migrations\20240209000000_create_product_components_table.sql" "20240121000000_create_product_components_table.sql"
cp "supabase\migrations\20240210000000_create_sales_discounts.sql" "20240122000000_create_sales_discounts.sql"
cp "supabase\migrations\20240211000000_add_facturada_status_to_reservations.sql" "20240123000000_add_facturada_status_to_reservations.sql"
cp "supabase\migrations\20240212000000_add_pos_enabled_to_product.sql" "20240124000000_add_pos_enabled_to_product.sql"
cp "supabase\migrations\20240213000000_create_reservation_payments_table.sql" "20240125000000_create_reservation_payments_table.sql"
cp "supabase\migrations\20240214000000_create_petty_cash_income.sql" "20240126000000_create_petty_cash_income.sql"
cp "supabase\migrations\20240215000000_initial_schema.sql" "20240127000000_initial_schema.sql"
cp "supabase\migrations\20240216000000_create_client_tables.sql" "20240128000000_create_client_tables.sql"
cp "supabase\migrations\20240217000000_add_read_policy_to_roles.sql" "20240129000000_add_read_policy_to_roles.sql"
cp "supabase\migrations\20240218000000_add_user_policies.sql" "20240130000000_add_user_policies.sql"
cp "supabase\migrations\20240219000000_add_isCashier_to_user.sql" "20240131000000_add_isCashier_to_user.sql"
cp "supabase\migrations\20240220000000_add_client_tables.sql" "20240201000000_add_client_tables.sql"
cp "supabase\migrations\20240221000000_add_client_tables_interface.sql" "20240202000000_add_client_tables_interface.sql"
cp "supabase\migrations\20240222000000_add_economic_sector_hierarchy.sql" "20240203000000_add_economic_sector_hierarchy.sql"
cp "supabase\migrations\20240223000000_add_cash_register_table.sql" "20240204000000_add_cash_register_table.sql"
cp "supabase\migrations\20240224000000_add_user_policies.sql" "20240205000000_add_user_policies.sql"
cp "supabase\migrations\20240225000000_enable_user_read_for_all.sql" "20240206000000_enable_user_read_for_all.sql"
cp "supabase\migrations\20240226000000_add_user_id_to_petty_cash_tables.sql" "20240207000000_add_user_id_to_petty_cash_tables.sql"
cp "supabase\migrations\20240227000000_add_active_to_supplier.sql" "20240208000000_add_active_to_supplier.sql"
cp "supabase\migrations\20240228000000_add_session_number_to_cash_session.sql" "20240209000000_add_session_number_to_cash_session.sql"
cp "supabase\migrations\20240229000000_add_vat_to_supplier.sql" "20240210000000_add_vat_to_supplier.sql"
cp "supabase\migrations\20240301000000_add_supplier_rls_policies.sql" "20240211000000_add_supplier_rls_policies.sql"
cp "supabase\migrations\20240302000000_implement_supplier_role_based_permissions.sql" "20240212000000_implement_supplier_role_based_permissions.sql"
cp "supabase\migrations\20240303000000_fix_user_role_function_properly.sql" "20240213000000_fix_user_role_function_properly.sql"
cp "supabase\migrations\20240304000000_setup_client_images_storage.sql" "20240214000000_setup_client_images_storage.sql"
cp "supabase\migrations\20240305000000_create_supplier_contact_table.sql" "20240215000000_create_supplier_contact_table.sql"
cp "supabase\migrations\20240306000000_create_supplier_contact_table_safe.sql" "20240216000000_create_supplier_contact_table_safe.sql"
cp "supabase\migrations\20240307000000_enhance_rooms_system.sql" "20240217000000_enhance_rooms_system.sql"
cp "supabase\migrations\20240308000000_fix_reservations_triggers.sql" "20240218000000_fix_reservations_triggers.sql"
cp "supabase\migrations\20240309000000_add_supplierrank_column.sql" "20240219000000_add_supplierrank_column.sql"
cp "supabase\migrations\20240310000000_fix_cash_session_rls_policies.sql" "20240220000000_fix_cash_session_rls_policies.sql"
cp "supabase\migrations\20240311000000_fix_petty_cash_transactions_rls_policies.sql" "20240221000000_fix_petty_cash_transactions_rls_policies.sql"
cp "supabase\migrations\20240312000000_add_client_integration_to_reservations.sql" "20240222000000_add_client_integration_to_reservations.sql"
cp "supabase\migrations\20240313000000_add_icono_to_supplier_tags.sql" "20240223000000_add_icono_to_supplier_tags.sql"
cp "supabase\migrations\20240314000000_fix_product_creation_rls.sql" "20240224000000_fix_product_creation_rls.sql"
cp "supabase\migrations\20240315000000_fix_all_rls_policies.sql" "20240225000000_fix_all_rls_policies.sql"
cp "supabase\migrations\20240316000000_fix_warehouse_product_rls.sql" "20240226000000_fix_warehouse_product_rls.sql"
cp "supabase\migrations\20240317000000_add_category_id_to_spa_products.sql" "20240227000000_add_category_id_to_spa_products.sql"
cp "supabase\migrations\20240318000000_create_programas_alojamiento_category.sql" "20240228000000_create_programas_alojamiento_category.sql"
cp "supabase\migrations\20240319000000_create_season_configuration.sql" "20240229000000_create_season_configuration.sql"
cp "supabase\migrations\20240320000000_fix_price_function_final.sql" "20240301000000_fix_price_function_final.sql"
cp "supabase\migrations\20240321000000_add_final_price_with_vat_to_product.sql" "20240302000000_add_final_price_with_vat_to_product.sql"
cp "supabase\migrations\20240322000000_create_inventory_movements_table.sql" "20240303000000_create_inventory_movements_table.sql"
cp "supabase\migrations\20240323000000_20250708_create_sales_module.sql" "20240304000000_20250708_create_sales_module.sql"
cp "supabase\migrations\20240324000000_final_pos_system.sql" "20240305000000_final_pos_system.sql"
cp "supabase\migrations\20240325000000_add_generate_sale_number_function.sql" "20240306000000_add_generate_sale_number_function.sql"
cp "supabase\migrations_backup_20250709\20250101000000_create_reservations_module.sql" "20240307000000_create_reservations_module.sql"
cp "supabase\migrations_backup_20250709\20250101000001_add_payment_method_to_petty_cash.sql" "20240308000000_add_payment_method_to_petty_cash.sql"
cp "supabase\migrations_backup_20250709\20250101000013_add_parent_id_to_warehouse.sql" "20240309000000_add_parent_id_to_warehouse.sql"
cp "supabase\migrations_backup_20250709\20250101000014_create_supplier_payment_table.sql" "20240310000000_create_supplier_payment_table.sql"
cp "supabase\migrations_backup_20250709\20250101000015_create_storage_buckets.sql" "20240311000000_create_storage_buckets.sql"
cp "supabase\migrations_backup_20250709\20250101000018_add_type_and_equipment_fields_to_product.sql" "20240312000000_add_type_and_equipment_fields_to_product.sql"
cp "supabase\migrations_backup_20250709\20250101000019_add_service_counter_to_product.sql" "20240313000000_add_service_counter_to_product.sql"
cp "supabase\migrations_backup_20250709\20250101000020_create_inventory_physical_history_table.sql" "20240314000000_create_inventory_physical_history_table.sql"
cp "supabase\migrations_backup_20250709\20250101000020_make_client_id_required_reservations.sql" "20240315000000_make_client_id_required_reservations.sql"
cp "supabase\migrations_backup_20250709\20250101000020_modular_products_system.sql" "20240316000000_modular_products_system.sql"
cp "supabase\migrations_backup_20250709\20250101000021_create_product_package_linkage.sql" "20240317000000_create_product_package_linkage.sql"
cp "supabase\migrations_backup_20250709\20250101000022_create_supplier_tags.sql" "20240318000000_create_supplier_tags.sql"
cp "supabase\migrations_backup_20250709\20250101000023_fix_reservation_products_references.sql" "20240319000000_fix_reservation_products_references.sql"
cp "supabase\migrations_backup_20250709\20250101000040_update_supplier_rank_types.sql" "20240320000000_update_supplier_rank_types.sql"
cp "supabase\migrations_backup_20250709\20250101000041_update_supplier_rank_constraint.sql" "20240321000000_update_supplier_rank_constraint.sql"
cp "supabase\migrations_backup_20250709\20250101000050_fix_supplier_rank_constraint.sql" "20240322000000_fix_supplier_rank_constraint.sql"
cp "supabase\migrations_backup_20250709\20250101000052_use_final_price_with_vat.sql" "20240323000000_use_final_price_with_vat.sql"
cp "supabase\migrations_backup_20250709\20250101000053_create_modular_reservations.sql" "20240324000000_create_modular_reservations.sql"
cp "supabase\migrations_backup_20250709\20250101000053_fix_final_price_with_vat_correct.sql" "20240325000000_fix_final_price_with_vat_correct.sql"
cp "supabase\migrations_backup_20250709\20250102000001_add_modular_reservations_rls_policies.sql" "20240326000000_add_modular_reservations_rls_policies.sql"
cp "supabase\migrations_backup_20250709\20250115000001_create_reservation_payments_table.sql" "20240327000000_create_reservation_payments_table.sql"
cp "supabase\migrations_backup_20250709\20250127000000_create_petty_cash_income.sql" "20240328000000_create_petty_cash_income.sql"
cp "supabase\migrations_backup_20250709\20250623003309_initial_schema.sql" "20240329000000_initial_schema.sql"
cp "supabase\migrations_backup_20250709\20250623174020_create_client_tables.sql" "20240330000000_create_client_tables.sql"
cp "supabase\migrations_backup_20250709\20250626000000_add_read_policy_to_roles.sql" "20240331000000_add_read_policy_to_roles.sql"
cp "supabase\migrations_backup_20250709\20250627000000_add_user_policies.sql" "20240401000000_add_user_policies.sql"
cp "supabase\migrations_backup_20250709\20250627000001_add_isCashier_to_user.sql" "20240402000000_add_isCashier_to_user.sql"
cp "supabase\migrations_backup_20250709\20250627000002_add_client_tables.sql" "20240403000000_add_client_tables.sql"
cp "supabase\migrations_backup_20250709\20250627000003_add_client_tables_interface.sql" "20240404000000_add_client_tables_interface.sql"
cp "supabase\migrations_backup_20250709\20250627000004_add_economic_sector_hierarchy.sql" "20240405000000_add_economic_sector_hierarchy.sql"
cp "supabase\migrations_backup_20250709\20250627000005_add_cash_register_table.sql" "20240406000000_add_cash_register_table.sql"
cp "supabase\migrations_backup_20250709\20250627000006_add_user_policies.sql" "20240407000000_add_user_policies.sql"
cp "supabase\migrations_backup_20250709\20250627000007_enable_user_read_for_all.sql" "20240408000000_enable_user_read_for_all.sql"
cp "supabase\migrations_backup_20250709\20250627000008_add_user_id_to_petty_cash_tables.sql" "20240409000000_add_user_id_to_petty_cash_tables.sql"
cp "supabase\migrations_backup_20250709\20250627000010_add_active_to_supplier.sql" "20240410000000_add_active_to_supplier.sql"
cp "supabase\migrations_backup_20250709\20250627230000_add_session_number_to_cash_session.sql" "20240411000000_add_session_number_to_cash_session.sql"
cp "supabase\migrations_backup_20250709\20250628000000_add_vat_to_supplier.sql" "20240412000000_add_vat_to_supplier.sql"
cp "supabase\migrations_backup_20250709\20250628000001_add_supplier_rls_policies.sql" "20240413000000_add_supplier_rls_policies.sql"
cp "supabase\migrations_backup_20250709\20250628000002_implement_supplier_role_based_permissions.sql" "20240414000000_implement_supplier_role_based_permissions.sql"
cp "supabase\migrations_backup_20250709\20250628000004_fix_user_role_function_properly.sql" "20240415000000_fix_user_role_function_properly.sql"
cp "supabase\migrations_backup_20250709\20250628000005_setup_client_images_storage.sql" "20240416000000_setup_client_images_storage.sql"
cp "supabase\migrations_backup_20250709\20250628000010_create_supplier_contact_table.sql" "20240417000000_create_supplier_contact_table.sql"
cp "supabase\migrations_backup_20250709\20250628000011_create_supplier_contact_table_safe.sql" "20240418000000_create_supplier_contact_table_safe.sql"
cp "supabase\migrations_backup_20250709\20250628000012_enhance_rooms_system.sql" "20240419000000_enhance_rooms_system.sql"
cp "supabase\migrations_backup_20250709\20250628000014_fix_reservations_triggers.sql" "20240420000000_fix_reservations_triggers.sql"
cp "supabase\migrations_backup_20250709\20250629000030_add_supplierrank_column.sql" "20240421000000_add_supplierrank_column.sql"
cp "supabase\migrations_backup_20250709\20250629202802_fix_cash_session_rls_policies.sql" "20240422000000_fix_cash_session_rls_policies.sql"
cp "supabase\migrations_backup_20250709\20250629204218_fix_petty_cash_transactions_rls_policies.sql" "20240423000000_fix_petty_cash_transactions_rls_policies.sql"
cp "supabase\migrations_backup_20250709\20250630000001_add_client_integration_to_reservations.sql" "20240424000000_add_client_integration_to_reservations.sql"
cp "supabase\migrations_backup_20250709\20250630000002_add_icono_to_supplier_tags.sql" "20240425000000_add_icono_to_supplier_tags.sql"
cp "supabase\migrations_backup_20250709\20250630164638_fix_product_creation_rls.sql" "20240426000000_fix_product_creation_rls.sql"
cp "supabase\migrations_backup_20250709\20250630170600_fix_all_rls_policies.sql" "20240427000000_fix_all_rls_policies.sql"
cp "supabase\migrations_backup_20250709\20250701120000_fix_warehouse_product_rls.sql" "20240428000000_fix_warehouse_product_rls.sql"
cp "supabase\migrations_backup_20250709\20250703000001_add_category_id_to_spa_products.sql" "20240429000000_add_category_id_to_spa_products.sql"
cp "supabase\migrations_backup_20250709\20250703000003_create_programas_alojamiento_category.sql" "20240430000000_create_programas_alojamiento_category.sql"
cp "supabase\migrations_backup_20250709\20250703000004_create_season_configuration.sql" "20240501000000_create_season_configuration.sql"
cp "supabase\migrations_backup_20250709\20250704000001_fix_price_function_final.sql" "20240502000000_fix_price_function_final.sql"
cp "supabase\migrations_backup_20250709\20250705000001_add_final_price_with_vat_to_product.sql" "20240503000000_add_final_price_with_vat_to_product.sql"
cp "supabase\migrations_backup_20250709\20250705002042_create_inventory_movements_table.sql" "20240504000000_create_inventory_movements_table.sql"

echo "Migraciones reorganizadas exitosamente!"
echo "Total de migraciones procesadas: 125"
echo "Verificar que todo funcione correctamente antes de continuar."
